#include "AdaptiveFilter_test.h"
#include <debug_config.h>
#include <stdio.h>
#include <math.h>
static double weights[L] = {0};
static double esti[L] = {0};
static double inBuffer[L] = {0};
static double aulixBuffer[L] = {0};  
static double referFilterBuffer[L] = {0};  
static double filterOutputBuffer[L] = {0};
static double peBuffer[L] = {0};
static double pfBuffer[L] = {0};
static double pw[M] = {
        0.2, -0.001, 0.001, 0.4, 0.9, -0.1, -0.5, -0.03, 0.2, -0.05, 
        0.05, -0.001, 0.01, 0.3, 0.06, -0.5, -0.5, -0.1, 0.4, -0.01, 
        0.01, -0.003, 0.003, 0.4, 0.8, -0.2, -0.5, -0.1, 0.4, -0.05, 
        0.2, -0.4
    };
static AfData g_tAfdata = 
{
    STEPSIZE,
    L,
    0.0,
    inBuffer,
    referFilterBuffer,
    weights,
    filterOutputBuffer
};

static OMData g_tOMdata = 
{
    MUS,
    L,
    0.0,
    aulixBuffer,
    esti,
    peBuffer,
    pfBuffer,
    1.0
};
//static double vs[N] = {0};
/*
static double vs[100] = {
        0.120226027329295, 0.410069155555281, -0.505093513196618, 0.192787815272982,
        0.0712780745188707, -0.292407992391948, -0.0969541236377114, 0.0766131597935023,
        0.800153880770402, 0.619264945822770, -0.301843896012917, 0.678629517722732,
        0.162205315814504, -0.0140994982764700, 0.159821371939074, -0.0458318039438481,
        -0.0277595201634078, 0.333106511692712, 0.315069690183561, 0.316893857362560,
        0.150151323744393, -0.270002284106578, 0.160379438046155, 0.364531692589136,
        0.109319970419333, 0.231364390602020, 0.162536457007892, -0.0678514534976932,
        0.0657116577075720, -0.176041786672094, 0.198651302352396, -0.256492673414098,
        -0.239006700360506, -0.181009410843135, -0.658361953129659, 0.321631611223061,
        0.0727148151863886, -0.168807103980311, 0.306408068512165, -0.382706705716387,
        -0.0228621059633015, -0.0539891998000272, 0.0713767967650106, 0.0699573089426477,
        -0.193393028751188, -0.00671967411068374, -0.0368680695014903, 0.140359616488624,
        0.244461635343907, 0.248041049909115, -0.193118641892629, 0.0172980186445231,
        -0.271484824216513, -0.248986335096083, -0.00153155632392860, 0.342706555370116,
        -0.172102530311772, 0.0830428270734655, -0.0504422058142177, 0.249848428146584,
        -0.243522179560469, 0.00728007030478941, 0.123548797861239, 0.246103926391247,
        0.345296277001064, 0.0192147855163839, -0.333529732916572, -0.165983736793603,
        -0.237376891937554, 0.525578213107402, -0.137652765403674, 0.167275054075152,
        -0.0430260869804620, 0.198699331675574, -0.171025488550458, -0.313556873818003,
        -0.318052925806373, 0.109163476864823, -0.0396622907719365, -0.0438388925963122,
        0.317367397799221, 0.0652002481405353, 0.0442318962247156, 0.355020309299655,
        -0.179884056398197, 0.155769954862580, 0.186731390430808, -0.0544963621031005,
        0.0482252973912026, -0.260690628194947, -0.256690044857704, 0.0234506994133867,
        0.161500911307843, 0.578133419608100, -0.149121287324873, 0.0418884905253193,
        -0.0184463142894240, -0.432237064637980, -0.0981558160019790, -0.401302388727422
    };
*/
static double vs[100] = {
        0.120226027329295, 0.410069155555281, -0.505093513196618, 0.192787815272982,
        0.0712780745188707, -0.292407992391948, -0.0969541236377114, 0.0766131597935023,
        0.800153880770402, 0.619264945822770, -0.301843896012917, 0.678629517722732,
        0.162205315814504, -0.0140994982764700, 0.159821371939074, -0.0458318039438481,
        -0.0277595201634078, 0.333106511692712, 0.315069690183561, 0.316893857362560,
        0.150151323744393, -0.270002284106578, 0.160379438046155, 0.364531692589136,
        0.109319970419333, 0.231364390602020, 0.162536457007892, -0.0678514534976932,
        0.0657116577075720, -0.176041786672094, 0.198651302352396, -0.256492673414098,
        -0.239006700360506, -0.181009410843135, -0.658361953129659, 0.321631611223061,
        0.0727148151863886, -0.168807103980311, 0.306408068512165, -0.382706705716387,
        -0.0228621059633015, -0.0539891998000272, 0.0713767967650106, 0.0699573089426477,
        -0.193393028751188, -0.00671967411068374, -0.0368680695014903, 0.140359616488624,
        0.244461635343907, 0.248041049909115, -0.193118641892629, 0.0172980186445231,
        -0.271484824216513, -0.248986335096083, -0.00153155632392860, 0.342706555370116,
        -0.172102530311772, 0.0830428270734655, -0.0504422058142177, 0.249848428146584,
        -0.243522179560469, 0.00728007030478941, 0.123548797861239, 0.246103926391247,
        0.345296277001064, 0.0192147855163839, -0.333529732916572, -0.165983736793603,
        -0.237376891937554, 0.525578213107402, -0.137652765403674, 0.167275054075152,
        -0.0430260869804620, 0.198699331675574, -0.171025488550458, -0.313556873818003,
        -0.318052925806373, 0.109163476864823, -0.0396622907719365, -0.0438388925963122,
        0.317367397799221, 0.0652002481405353, 0.0442318962247156, 0.355020309299655,
        -0.179884056398197, 0.155769954862580, 0.186731390430808, -0.0544963621031005,
        0.0482252973912026, -0.260690628194947, -0.256690044857704, 0.0234506994133867,
        0.161500911307843, 0.578133419608100, -0.149121287324873, 0.0418884905253193,
        -0.0184463142894240, -0.432237064637980, -0.0981558160019790, -0.401302388727422
    };


// 可以在程序中使用 vs 数组...

static double dn[DLEN] = {0};
// static double a[N] = {0};


void AdaptiveFilterTestRun(void)
{
    int i;

	// GetInputSignalIntoBuf(a);       /* 得到输入参考信号 */

    convolution(pw, dn);  /* 得到期望信号 */
    
    
    /* 迭代N次 */	
    for(i = 0; i < N; i++)
    {
        //generate_gaussian_noise(VARIANCE);
        AdaptiveFilterRun(sin(2 * PI * F * (i+1) / FS), dn[i], vs[i], &g_tAfdata, &g_tOMdata);                        
    }
    for(i = 0; i < L; i++)
    {
        //generate_gaussian_noise(VARIANCE);
        DEBUG("g_tAfdata.pWeights[%d] = %.15f\r\n", i, g_tAfdata.pWeights[i]);            
    }


    
	   

}